files:
  "/etc/nginx/conf.d/https_redirect.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      server {
          listen 80;
          
          # Add a location block to serve the health check without redirecting
          location /health/ {
              proxy_pass http://127.0.0.1:8000;
              # or simply return 200 here if you prefer not to hit Django
              # return 200;
          }

          # For all other requests, redirect to HTTPS
          location / {
              return 301 https://$host$request_uri;
          }
      }
